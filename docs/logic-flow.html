<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>論理フロー | Bocchy Discord Bot</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Kaisei+Decol&family=Yomogi&family=Zen+Kurenaido&display=swap">
  <link rel="stylesheet" href="./assets/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <!-- ヘッダー -->
    <header class="header">
      <h1 class="title">Bocchy Discord Bot の論理フロー</h1>
      <p class="date">最終更新: 2024-05-01 09:00</p>
    </header>

    <!-- ナビゲーション -->
    <nav class="nav-menu">
      <a href="index.html" class="nav-link">🏠 ホーム</a>
      <a href="update-history.html" class="nav-link">🕒 更新履歴</a>
      <a href="rules.html" class="nav-link">📜 ルール・マニフェスト</a>
      <a href="logic-flow.html" class="nav-link active">🔄 論理フロー</a>
    </nav>

    <!-- フローコンテナ -->
    <div class="flow-container">
      <div class="flow-section">
        <h2 class="flow-title"><i class="fas fa-project-diagram"></i> 自然対話処理フロー</h2>
        <div class="flow-chart">

          <!-- ステップ1 -->
          <div class="flow-step">
            <div class="flow-step-icon"><i class="fas fa-microphone-alt"></i></div>
            <div class="flow-step-content">
              <h3 class="flow-step-title">ユーザー入力</h3>
              <p class="flow-step-description">Discordでのテキストまたは音声入力を受信</p>
              <div class="flow-step-details">
                <ul>
                  <li>Discord.jsのイベントリスナーがメッセージを捕捉</li>
                  <li>メンションまたはDMを処理対象として識別</li>
                  <li>テキスト整形・フィルタリングを実施</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ステップ2 -->
          <div class="flow-step">
            <div class="flow-step-icon"><i class="fas fa-brain"></i></div>
            <div class="flow-step-content">
              <h3 class="flow-step-title">意図理解 & 判断</h3>
              <p class="flow-step-description">フラグ検出と行動タイプの決定</p>
              <div class="flow-step-details">
                <ul>
                  <li>検索 or 介入 or 両方のトリガーパターンを評価</li>
                  <li>重み付けによるアクション選択: <code>search</code>, <code>intervention</code>, <code>combined</code></li>
                  <li>decision_matrixに基づき次のステップを設定</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ステップ3 -->
          <div class="flow-step">
            <div class="flow-step-icon"><i class="fas fa-search"></i></div>
            <div class="flow-step-content">
              <h3 class="flow-step-title">情報検索 (search.google)</h3>
              <p class="flow-step-description">Google Custom Search APIで最新情報を取得</p>
              <div class="flow-step-details">
                <ul>
                  <li>指定クエリをAPIに送信</li>
                  <li>検索結果を要約し候補を抽出</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ステップ4 -->
          <div class="flow-step">
            <div class="flow-step-icon"><i class="fas fa-comments"></i></div>
            <div class="flow-step-content">
              <h3 class="flow-step-title">応答生成 (llm.respond)</h3>
              <p class="flow-step-description">OpenAI GPT-4o/5 APIで自然な応答を生成</p>
              <div class="flow-step-details">
                <ul>
                  <li>文脈と検索結果をプロンプトに組み込み</li>
                  <li>最適な応答を作成しDiscordへ送信</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- ステップ5 -->
          <div class="flow-step">
            <div class="flow-step-icon"><i class="fas fa-database"></i></div>
            <div class="flow-step-content">
              <h3 class="flow-step-title">記憶保存</h3>
              <p class="flow-step-description">Supabaseに会話履歴と要約を保存</p>
              <div class="flow-step-details">
                <ul>
                  <li>重要な会話ポイントを保存</li>
                  <li>次回以降の文脈維持に活用</li>
                </ul>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- フッター -->
    <footer class="footer">
      <p>&copy; 2024 Bocchyプロジェクト All Rights Reserved.</p>
    </footer>
  </div>
</body>
</html> 